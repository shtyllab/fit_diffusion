%\documentclass{article}
\documentclass{tufte-handout}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage{hyperref}
\usepackage{amsmath}
\usepackage{natbib}

\author{Blerta and Marc and others! :-)}
\title{Modeling the Fate and Transport of Pollutants}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
\maketitle


I am getting ready to assemble projects for math modeling—I need some help crafting a one paragraph project description for students, and I am looking through our shared folder and not seeing much of a narrative for the diffusion fitting we talked about a while ago. Do you have anything I can use? Also, any references would be greatly appreciated. I would like to craft this next week, so we can both agree on its content before Spring break. 


\section{Abstract}
\noindent The movement of compounds in the environment is driven by two processes, advection and diffusion. Of course, these processes occur in three dimensions, but for this class we'll begin with one dimensional processes before getting to more complecated examples.

\section{Introduction}

The movement of contaminants through a media (e.g. air, water, and soil) is complex and difficult to predict. 

In general, pollutants move in two ways: advection and dispersion. Advection is the bulk flow of materials that are "carried" by wind patterns, water currents, or groundwater flow paths. Dispersion is the spreading of the chemical via localizied mixing or diffusion. As you might guess, descriptions of advection and dispersion depend on the scale of interest, and can be described by a variety of equations.

NOTE: The term advection sometimes serves as a synonym for convection, but technically, convection covers the sum of transport both by diffusion and by advection. Advective transport describes the movement of some quantity via the bulk flow of a fluid.

We might describe the concentration of a contaminant:

\begin{equation}
C_t = f(\mathrm{advection}_t + \mathrm{dispersion_t})
\end{equation}

Of course, this depends on the time from which the contaminant was introduced the the environment. Below, we will further explore how to write out more useful equations for this conceptual idea.

In addition to these two processes, pollutants might react in or with their media. Thus, their concentration may change with time as part of the breakdown process. For example, organic pollutants, such as pesticides, might react in the surface of leaves, in runoff, in soils or sediments, which might change their fate and transport behavior that we might add a term: 

\begin{equation}
C_t = f(\mathrm{advection}_t + \mathrm{dispersion_t} - \mathrm{breakdown}_t)
\end{equation}

This breakdown might be a zero-, first-, or second- order reaction. In other words, the reaction might be time-independent, time-dependent or concentration dependent or something more complicated. Certainly, well beyond the scope of our interests, but nevertheless, is something to keep in mind as you think about pollution movement. 

One of the challenges for environmental scientists is to obtain meaningful chemical data from samples collected from air, surface waters, and groundwater to use to map the distribution of specific contaminants and to use as targets for any models that may be constructed to predict pollutant spread and concentrations or to model backward in time to understand the source of pollutants. 

\section{Session Outcomes}
\begin{enumerate}
	\item Describe Advection Mathematically
	\item Analyze 1-dimensional movement using advection equations
	\item Describe Diffuions mathematically
	\item Analyze 1-dimensional movement using Fick's law.
	\item Two dimensional analysis of advention
\end{enumerate}

\section{Material Transport}

\section{Theory of Pollution Movement}

According to Wikipedia, advection can be described as as "velocity vector" and the del operator.

\textbf{Blerta, I sure wish I knew where these terms came from!}

\begin{equation}
\mathbf{u} \cdot \nabla = u_x \frac{\partial}{\partial x} + u_y \frac{\partial}{\partial y} + u_z \frac{\partial}{\partial z}.
\end{equation}

where $u = (u_x, u_y, u_z)$ is the velocity field, and $\nabla$ is the del operator (note that Cartesian coordinates are used here).

The rest of the equation is... ???

Apparently, solving this equation is a nightmare!  So, we will come up with an alternative way to predict concentration gradients...

\subsection{Diffusion versus Advection}

Fick's first law relates the diffusive flux to the concentration under the assumption of steady state. It postulates that the flux goes from regions of high concentration to regions of low concentration, with a magnitude that is proportional to the concentration gradient (spatial derivative), or in simplistic terms the concept that a solute will move from a region of high concentration to a region of low concentration across a concentration gradient. In one (spatial) dimension, the law is:

\begin{equation}
J=-D{\frac {\partial \varphi }{\partial x}}
\end{equation}

where

J is the "diffusion flux," of which the dimension is amount of substance per unit area per unit time, so it is expressed in such units as $mol\cdot m^{−2}\cdot s^{−1}$. J measures the amount of substance that will flow through a unit area during a unit time interval.

D is the diffusion coefficient or diffusivity. Its dimension is area per unit time, so typical units for expressing it would be $m^2/s$. $\varphi$ (for ideal mixtures) is the concentration, of which the dimension is amount of substance per unit volume. It might be expressed in units of $mol/m^3$.
x is position, the dimension of which is length. It might thus be expressed in the unit $m$.

\begin{description}
	\item[What is diffusion?]

	\item[Why is diffusion important?]
	
	\item[What do we know about diffusion?]
	
In free solution and in the absence of any interactions with other macromolecules, the diffusion process is controlled by the size of the macromolecule as described by the Stokes-Einstein relation:

\begin{equation}
D_0 =  \frac{k_B T}{6 \pi \nu R_H}
\end{equation}

where $k_B$ is Boltzmann's constant, T the temperature in Kelvin, $\nu$ the solvent viscosity, and $R_H$ the hydrodynamic radius.

  \item[Steady-state versus ??]
	\item[What are current areas of research concerning diffusion and environmental issues?]
\end{description}


\section{Modeling with R}

\section{One Dimensional Diffusion}


\subsection{Steady-state solution of 2-D PDEs}

To develop our models, we will use the \href{https://cran.r-project.org/web/packages/rootSolve/vignettes/rootSolve.pdf}{\texttt{\textbf{rootSolve}} Package}. For this portion of our work, we will rely on the \texttt{steady.2D()} function that can solve steady-state, 2-dimensional problems.

\begin{equation}
%\fraction{\deltaC}{\deltat} = \ldots C^2 + pxy
\end{equation}

a substance C is consumed at a quadratic rate (r dot C2), while dispersing in X- and Y-direction.
At certain positions (x,y) the substance is produced (rate p).

The model is solved on a square (100*100) grid. There are zero-flux boundary conditions at
the 4 boundaries.

The term Dx \ldots, 

i.e. it is the negative of the 
ux gradient, where the ux is due to diffusion. In the numerical approximation fo the 
ux, the concentration gradient is approximated as the subtraction of two matrices, with the columns or rows shifted (e.g. Conc[2:n,]-Conc[1:(n-1),]).

The flux gradient is then also approximated by subtracting entire matrices (e.g. Flux[2:(n+1),]-Flux[1:(n),]). This is very fast. The zero-flux at the boundaries is imposed by binding a column or row with 0-s.


\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{library}\hlstd{(rootSolve)}
\hlstd{diffusion2D} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{t}\hlstd{,}\hlkwc{conc}\hlstd{,}\hlkwc{par}\hlstd{)\{}
\hlstd{Conc} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlkwc{nr}\hlstd{=n,}\hlkwc{nc}\hlstd{=n,}\hlkwc{data}\hlstd{=conc)} \hlcom{# vector to 2-D matrix}
\hlstd{dConc} \hlkwb{<-} \hlopt{-}\hlstd{r}\hlopt{*}\hlstd{Conc}\hlopt{*}\hlstd{Conc} \hlcom{# consumption}
\hlstd{BND} \hlkwb{<-} \hlkwd{rep}\hlstd{(}\hlnum{1}\hlstd{,n)} \hlcom{# boundary concentration}

\hlcom{# constant production in certain cells}
\hlstd{dConc[ii]}\hlkwb{<-} \hlstd{dConc[ii]}\hlopt{+} \hlstd{p}

\hlcom{#diffusion in X-direction; boundaries=imposed concentration}

\hlstd{Flux} \hlkwb{<-} \hlopt{-}\hlstd{Dx} \hlopt{*} \hlkwd{rbind}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,n),(Conc[}\hlnum{2}\hlopt{:}\hlstd{n,]}\hlopt{-}\hlstd{Conc[}\hlnum{1}\hlopt{:}\hlstd{(n}\hlopt{-}\hlnum{1}\hlstd{),]),}\hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,n))}\hlopt{/}\hlstd{dx}
\hlstd{dConc} \hlkwb{<-} \hlstd{dConc} \hlopt{-} \hlstd{(Flux[}\hlnum{2}\hlopt{:}\hlstd{(n}\hlopt{+}\hlnum{1}\hlstd{),]}\hlopt{-}\hlstd{Flux[}\hlnum{1}\hlopt{:}\hlstd{n,])}\hlopt{/}\hlstd{dx}

\hlcom{#diffusion in Y-direction}
\hlstd{Flux} \hlkwb{<-} \hlopt{-}\hlstd{Dy} \hlopt{*} \hlkwd{cbind}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,n),(Conc[,}\hlnum{2}\hlopt{:}\hlstd{n]}\hlopt{-}\hlstd{Conc[,}\hlnum{1}\hlopt{:}\hlstd{(n}\hlopt{-}\hlnum{1}\hlstd{)]),}\hlkwd{rep}\hlstd{(}\hlnum{0}\hlstd{,n))}\hlopt{/}\hlstd{dy}
\hlstd{dConc} \hlkwb{<-} \hlstd{dConc} \hlopt{-} \hlstd{(Flux[,}\hlnum{2}\hlopt{:}\hlstd{(n}\hlopt{+}\hlnum{1}\hlstd{)]}\hlopt{-}\hlstd{Flux[,}\hlnum{1}\hlopt{:}\hlstd{n])}\hlopt{/}\hlstd{dy}

\hlkwd{return}\hlstd{(}\hlkwd{list}\hlstd{(}\hlkwd{as.vector}\hlstd{(dConc)))}
\hlstd{\}}
\end{alltt}
\end{kframe}
\end{knitrout}

After specifying the values of the parameters, 10 cells on the 2-D grid where there will be
substance produced are randomly selected (ii).


Figure 5: Steady-state solution of the nonlinear 2-Dimensional model

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{# parameters}
\hlstd{dy} \hlkwb{<-} \hlstd{dx} \hlkwb{<-} \hlnum{1} \hlcom{# grid size}
\hlstd{Dy} \hlkwb{<-} \hlstd{Dx} \hlkwb{<-} \hlnum{1.5} \hlcom{# diffusion coeff, X- and Y-direction}
\hlstd{r} \hlkwb{<-} \hlnum{0.01} \hlcom{# 2-nd-order consumption rate (/time)}
\hlstd{p} \hlkwb{<-} \hlnum{20} \hlcom{# 0-th order production rate (CONC/t)}
\hlstd{n} \hlkwb{<-} \hlnum{100}
\hlcom{# 10 random cells where substance is produced at rate p}
\hlstd{ii} \hlkwb{<-} \hlkwd{trunc}\hlstd{(}\hlkwd{cbind}\hlstd{(}\hlkwd{runif}\hlstd{(}\hlnum{10}\hlstd{)}\hlopt{*}\hlstd{n}\hlopt{+}\hlnum{1}\hlstd{,}\hlkwd{runif}\hlstd{(}\hlnum{10}\hlstd{)}\hlopt{*}\hlstd{n}\hlopt{+}\hlnum{1}\hlstd{))}
\end{alltt}
\end{kframe}
\end{knitrout}
The steady-state is found using function steady.2D. It takes as arguments a.o. the dimensionality
of the problem (dimens) and lrw=1000000, the length of the work array needed by
the solver. If this value is set too small, the solver will return with the size needed.
It takes about 0.5 second to solve this 10000 state variable model.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{Conc0} \hlkwb{<-} \hlkwd{matrix}\hlstd{(}\hlkwc{nr}\hlstd{=n,}\hlkwc{nc}\hlstd{=n,}\hlnum{10.}\hlstd{)}
\hlcom{# print(system.time(}
\hlcom{# not working yet...}

\hlstd{ST3} \hlkwb{<-} \hlkwd{steady.2D}\hlstd{(Conc0,}\hlkwc{func}\hlstd{=diffusion2D,}\hlkwc{parms}\hlstd{=}\hlkwa{NULL}\hlstd{,}\hlkwc{pos}\hlstd{=}\hlnum{TRUE}\hlstd{,}\hlkwc{dimens}\hlstd{=}\hlkwd{c}\hlstd{(n,n),} \hlkwc{lrw}\hlstd{=}\hlnum{1000000}\hlstd{,}\hlkwc{atol}\hlstd{=}\hlnum{1e-10}\hlstd{,}\hlkwc{rtol}\hlstd{=}\hlnum{1e-10}\hlstd{,}\hlkwc{ctol}\hlstd{=}\hlnum{1e-1}\hlstd{)}
\end{alltt}
\end{kframe}
\end{knitrout}


The S3 image method is used to generate the steady-state plot.

\begin{figure*}
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{image}\hlstd{(ST3,}\hlkwc{main}\hlstd{=}\hlstr{"2-D diffusion+production"}\hlstd{,} \hlkwc{xlab}\hlstd{=}\hlstr{"x"}\hlstd{,} \hlkwc{ylab}\hlstd{=}\hlstr{"y"}\hlstd{,} \hlkwc{las}\hlstd{=}\hlnum{1}\hlstd{)}
\end{alltt}
\end{kframe}
\includegraphics[width=\maxwidth]{figure/CreateImage-1} 

\end{knitrout}
\end{figure*}


\section{Diffusion Derivation}

\begin{itemize}

\item[a.) ]
From 9.3, Special Case 2, we know that if $A(x,t) = \bar{A}(x) \neq 0$ (if area does not change with time), then the equation can be written as
\begin{equation}
\frac{\partial c(x,t)}{\partial t} = - \frac{1}{\bar{A}(x)}\frac{\partial}{\partial x} [J(x,t)\bar{A}(x)] \pm \sigma(x,t)
\end{equation}
We now need to find an equation for $\bar{A}(x)$. Since arc length equals radius times angle, we get 
\begin{equation}
\bar{A}(r) = \theta r h
\end{equation}
 where $\theta$ is the angle of the arc, $r$ is radial distance, and $h$ is height of the section.
Therefore we get the equation
\begin{equation}
\frac{\partial c(r,t)}{\partial t} = - \frac{1}{\theta r h}\frac{\partial}{\partial r} [J(r,t)\theta r h] \pm \sigma(r,t)
\end{equation}
Since $\theta$ and $h$ are constants, we can factor them out to get
\begin{equation}
\frac{\partial c(r,t)}{\partial t} = - \frac{1}{r}\frac{\partial}{\partial r} [J(r,t)r] \pm \sigma(r,t)
\end{equation}

\item[b) ]
Extending the principle applied in part (a), we first need to find $\bar{A}(R)$. Since $\theta$ is small, we can approximate cross sectional area by taking horizontal arc length times vertical arc length. Therefore we get the equation
\begin{equation}
\bar{A}(R) = \theta_1 \theta_2 R^2
\end{equation}
where $\theta_1$ is the horizontal angle of the arc, $\theta_2$ is the vertical angle of the arc, and $R$ is radial distance. Combining this with equation (1) from above, we get
\begin{equation}
\frac{\partial c(R,t)}{\partial t} = - \frac{1}{\theta_1 \theta_2 R^2}\frac{\partial}{\partial R} [J(R,t)\theta_1 \theta_2 R^2] \pm \sigma(R,t)
\end{equation}
Since $\theta_1$ and $\theta_2$ are constants, we can simplify the equation as such:
\begin{equation}
\frac{\partial c(R,t)}{\partial t} = - \frac{1}{R^2}\frac{\partial}{\partial R} [J(R,t)R^2] \pm \sigma(R,t)
\end{equation}

\item[c )]
Part A: In order to obtain the equations in 9.5, we apply Fick's law:
\begin{equation}
J = -\mathcal{D} \nabla c
\end{equation}
In this case, we use the one-dimensional version:
\begin{equation}
J = - \mathcal{D} \frac{\partial c}{\partial x}
\end{equation}
Applying this to equation (4), we get
\begin{equation}
\frac{\partial c(r,t)}{\partial t} =  \frac{1}{r}\frac{\partial}{\partial r} [\mathcal{D} \frac{\partial c}{\partial r} r] \pm \sigma(r,t)
\end{equation}
Simplifying, and assuming that no particles are created or eliminated at the source, we get:
\begin{equation}
\frac{\partial c(r,t)}{\partial t} =  \frac{\mathcal{D}}{r}\frac{\partial}{\partial r} ( \frac{\partial c}{\partial r} r)
\end{equation}
\bigskip
Part B: Once again, we apply Fick's law in one dimension to get
\begin{equation}
\frac{\partial c(R,t)}{\partial t} =  \frac{1}{R^2}\frac{\partial}{\partial R} [\mathcal{D} \frac{\partial c}{\partial R} R^2] \pm \sigma(R,t)
\end{equation}
We again simplify, assuming no particles are created or destroyed at the source.
\begin{equation}
\frac{\partial c(R,t)}{\partial t} =  \frac{\mathcal{D}}{R^2}\frac{\partial}{\partial R} (\frac{\partial c}{\partial R} R^2)
\end{equation}

\end{itemize}

\section{Chang 1997 Key Points}
\subsection{Data}
\begin{itemize}
\item Size of halos measured with a ruler over constant time intervals
\item Experiment repeated three times to calculate average values used in model
\end{itemize}
\subsection{Methodology}
\begin{itemize}
\item Mathematical model formed using Fick's law
\item c(r,t) = lipase concentration as a function of time and radial distance
\item Used regression analysis to fit hindered diffusion coefficients and threshold values of lipase concentration as parameters. The finite difference method outlined in Constantinides, 1987 was used specifically.
\item Amount of lipase in plate at each time calculated by numerical integration. The total amount of lipase varied by 2.5\%, confirming the appropriateness of the mathematical model used. 
\end{itemize}

\section{Discretization}

% Fick's law
Fick's second law of molecular diffusion, expressed in cylindrical coordinates. 
\begin{align*}
\frac{\partial C}{\partial t} &= D \Delta^2 C\\
&= D(\frac{1}{r} \frac{\partial C}{\partial r} + \frac{\partial^2 C}{\partial r^2})
\end{align*}
Initial conditions:
\begin{equation}
\begin{cases} 
C=C_0  &\mbox{for } R_w < r < R_r\\
C=0 &\mbox{for } r<R_w \ \& \ R_r < r 
\end{cases}
\end{equation}
where D is the effective hindered diffusion coefficient, $C_0$ is the feed enzyme concentration, $R_w$ is the radius of the well, and $R_r$ is the outer radius of the absorption ring. The lipase concentration as a function of time and radial distance can be solved using the finite difference method. 
\begin{equation}
\frac{1}{\Delta t} (C_{i,j+1} - C_{i,j}) = [\frac{1}{i \Delta r} \frac{D}{2 \Delta r}(C_{i+1,j} - C_{i-1,j}) + \frac{D}{\Delta r^2}(C_{i+1,j}-2C_{i,j} + C_{i-1,j})]
\end{equation}
\begin{equation}
\frac{1}{\Delta t}C_{i,j+1} = \frac{1}{\Delta t}C_{i,j} - \frac{2D}{\Delta r^2}C_{i,j}+\frac{D}{2i\Delta r^2}(C_{i+1,j}-C_{i-1,j})+\frac{D}{\Delta r^2}(C_{i+1,j}+C_{i-1,j})
\end{equation}
\begin{equation}
C_{i,j+1} = (1-\frac{2D\Delta t}{\Delta r^2})C_{i,j} + \frac{D \Delta t}{\Delta r^2}[(\frac{1}{2i}+1)C_{i+1,j}-(\frac{1}{2i}-1)C_{i-1,j}]
\end{equation}
For convergence, to hold:
\begin{equation}
\frac{D \Delta t}{\Delta r^2} \leq \frac{1}{2}
\end{equation}
Lastly, the amount of lipase can be calculated using
\begin{equation}
A = \int_{R_w}^{R_r} 2 \pi r l C(r) \ dr
\end{equation}
where $A$ is the total amount of lipase in terms of enzyme activity, $R_w$ and $R_h$ are the radius of well and halo, respectively, $C(r)$ is the concentration at the radial distance of $r$, and $l$ is the thickness of agar plate.





\end{document}
